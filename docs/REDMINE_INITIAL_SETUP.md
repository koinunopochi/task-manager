# Redmine初期設定ガイド - MCP連携のための必須設定

MCP Redmineでチケット管理を行うためには、Redmineの初期設定が必要です。
このドキュメントでは、最低限必要な設定手順を詳しく説明します。

## 🚨 なぜ初期設定が必要か

新規インストールしたRedmineには、以下の基本設定が含まれていません：

- **トラッカー**（バグ、機能、タスクなどのチケット種別）
- **優先度**（低、中、高、緊急など）
- **ステータス**（新規、進行中、完了など）

これらが未設定の場合、MCP経由でチケットを作成しようとすると以下のエラーが発生します：

```bash
Error: Redmine API error: 422 - {"errors":["トラッカー を入力してください","優先度 を入力してください","ステータス を入力してください"]}
```

## 📋 設定手順

### 前提条件

- Redmineが起動していること（`make up`で起動）
- 管理者アカウントでログインできること（初期: admin/admin）

### ステップ1: 管理者でログイン

1. ブラウザで <http://localhost:15350> にアクセス
2. 右上の「ログイン」をクリック
3. ユーザー名: `admin`、パスワード: `admin` でログイン
4. 初回ログイン時はパスワード変更を求められるので、新しいパスワードを設定

### ステップ2: ステータスの設定（トラッカーより先に必要）

ステータスは、チケットの進行状況を定義します。トラッカー作成時にデフォルトステータスが必要なため、先に設定します。

1. 管理 → 「課題のステータス」をクリック
2. 「新しいステータス」をクリックして、以下を作成：

#### 必須ステータス

**1. New**

- 名称: `New`
- 終了したチケット: チェックしない
- 説明: 新規作成されたチケット

**2. In Progress**

- 名称: `In Progress`
- 終了したチケット: チェックしない
- 説明: 作業中のチケット

**3. Resolved**

- 名称: `Resolved`
- 終了したチケット: チェックする
- 説明: 作業が完了したチケット

**4. Rejected**

- 名称: `Rejected`
- 終了したチケット: チェックする
- 説明: 対応しないことが決定したチケット

**5. Closed**

- 名称: `Closed`
- 終了したチケット: チェックする
- 説明: 完全に終了したチケット

### ステップ3: トラッカーの設定

トラッカーは、チケットの種類を定義します（例：バグ報告、機能要望、タスクなど）。

1. 上部メニューの「管理」をクリック
2. 左側メニューの「トラッカー」をクリック
3. 「新しいトラッカー」をクリックして、以下を作成：

#### 必須トラッカー（最低限これらを作成）

**1. Bug**

- 名称: `Bug`
- デフォルトのステータス: `New`
- 説明: バグ報告用

**2. Feature**

- 名称: `Feature`
- デフォルトのステータス: `New`
- 説明: 新機能要望用

**3. Task**

- 名称: `Task`
- デフォルトのステータス: `New`
- 説明: 一般的な作業タスク用

### ステップ4: 優先度の設定

優先度は、チケットの重要度を定義します。

1. 管理 → 列挙項目 → 「チケットの優先度」をクリック
2. 「新しい項目」をクリックして、以下を作成：

#### 必須優先度（順番も重要）

| 名称 | 位置 | 説明 |
|------|------|------|
| Low | 1 | 急がない作業 |
| Normal | 2 | 通常の作業（デフォルト） |
| High | 3 | 優先的に対応が必要 |
| Urgent | 4 | 最優先で対応が必要 |

**重要**: 「位置」の数値は優先度の順序を決定します。数値が大きいほど優先度が高くなります。

### ステップ5: ワークフローの設定

ー＞ここら辺違いそう。スキップしてよし。有識者の方のHelp待ち

ワークフローは、ステータスの遷移ルールを定義します。

1. 管理 → 「ワークフロー」をクリック
2. ロール: `管理者`、トラッカー: `すべて` を選択して「編集」
3. すべてのステータス遷移にチェックを入れる（初期設定として）

#### 基本的なワークフロー設定

```bash
New → In Progress → Resolved → Closed
  ↓
  Rejected
```

**設定方法**:

1. 縦軸が「現在のステータス」、横軸が「新しいステータス」
2. 許可する遷移にチェックを入れる
3. 最初はすべてにチェックを入れて、後で制限を追加

### ステップ6: デフォルト値の設定

1. 管理 → 設定 → 「課題トラッキング」タブ
2. 以下を設定：
   - デフォルトの優先度: `Normal`
   - 新規プロジェクトにおいてデフォルトで有効になるトラッカー: すべてチェック

## ✅ 設定確認方法

設定が正しく完了したか、MCPツールで確認します：

```bash
# トラッカーの確認
redmine_tracker_list を実行

期待される結果:
Available Trackers:
• Bug (ID: 1)
• Feature (ID: 2)
• Task (ID: 3)

# 優先度の確認
redmine_priority_list を実行

期待される結果:
Available Issue Priorities:
• Low (ID: 1)
• Normal (ID: 2)
• High (ID: 3)
• Urgent (ID: 4)

# ステータスの確認
redmine_status_list を実行

期待される結果:
Available Issue Statuses:
• New (ID: 1)
• In Progress (ID: 2)
• Resolved (ID: 3)
• Rejected (ID: 4)
• Closed (ID: 5)
```

## 🎯 設定完了後のテスト

チケット作成が正常に動作するか確認：

```bash
redmine_issue_create で以下のチケットを作成:
- project_id: [プロジェクトID]
- subject: "Initial Setup Test"
- description: "Test ticket to confirm Redmine initial setup is complete"
- tracker_id: 3  # Task
- priority_id: 2  # Normal
```

## 📝 トラブルシューティング

### よくある問題

1. **設定しても422エラーが続く場合**
   - Redmineを再起動: `make restart`
   - ブラウザのキャッシュをクリア
   - APIキーを再生成

2. **ワークフローが機能しない**
   - ロールごとに個別に設定が必要
   - 「管理者」以外のロールも確認

3. **デフォルト値が反映されない**
   - プロジェクトごとの設定が優先される場合がある
   - プロジェクト設定も確認

## 🔗 参考リンク

- [Redmine公式ガイド - トラッカー](https://www.redmine.org/guide/RedmineIssueTrackingSetup#Trackers)
- [Redmine公式ガイド - ワークフロー](https://www.redmine.org/guide/RedmineIssueTrackingSetup#Workflow)
- [Redmine REST API - Issues](https://www.redmine.org/projects/redmine/wiki/Rest_Issues)
